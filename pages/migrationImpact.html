<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/png" href="../assets/img/favicon.ico">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <title>GeneX</title>

    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
    <meta name="viewport" content="width=device-width" />

    <!-- Bootstrap core CSS     -->
    <link href="../assets/css/bootstrap.min.css" rel="stylesheet" />

    <!-- Animation library for notifications   -->
    <link href="../assets/css/animate.min.css" rel="stylesheet"/>

    <!--  Light Bootstrap Table core CSS    -->
    <link href="../assets/css/light-bootstrap-dashboard.css" rel="stylesheet"/>

    <!--Custom Style-->
    <link href="../assets/css/style.css" rel="stylesheet"/>

    <!--     Fonts and icons     -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,700,300' rel='stylesheet' type='text/css'>
    <link href="../assets/css/pe-icon-7-stroke.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.bundle.min.js"></script>

    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>


    <style>
        #map { width: 100%; height: 600px; }
        body { font: 16px/1.4 "Helvetica Neue", Arial, sans-serif; }
        .ghbtns { position: relative; top: 4px; margin-left: 5px; }
        a { color: #0077ff; }
    </style>
    <style>
        html, body{padding: 0; margin: 0; background-color: black;}
        .no-js #loader { display: none;  }
        .js #loader { display: block; position: absolute; left: 100px; top: 0; }
        .se-pre-con {
            position: fixed;
            left: 0px;
            top: 0px;
            width: 100%;
            height: 100%;
            z-index: 9999;
            background: url(../assets/img/loader1.gif) center no-repeat #fff;
        }
    </style>
    <script>
        $(window).load(function() {
            // Animate loader off screen
            $(".se-pre-con").fadeOut("slow");;
        });
    </script>
</head>
<body>
<div class="se-pre-con"></div>
<div class="wrapper">
    <div class="sidebar" data-color="black" data-image="../assets/img/sidebar-2.jpg">

        <div class="sidebar-wrapper">
            <div class="logo">
                <a href="#" class="simple-text">
                    <img src="../assets\img\genex.png" style="height:50%;width:60%;border-radius: 25px;"/>
                </a>
            </div>

            <ul class="nav">
                <li>
                    <a href="../index.html">
                        <i class="pe-7s-map-2"></i>
                        <p>Why Care ?</p>
                    </a>
                </li>
                <li >
                    <a href="geneFlow.html">
                        <i class="pe-7s-male"></i>
                        <p>Gene Flow</p>
                    </a>
                </li>
                <li class="active">
                    <a href="migrationImpact.html">
                        <i class="pe-7s-global"></i>
                        <p>Impact of Migration</p>
                    </a>
                </li>
                <li>
                    <a href="climateImpact.html">
                        <i class="pe-7s-sun"></i>
                        <p>Impact of Climate</p>
                    </a>
                </li>
                <li>
                    <a href="populationImpact.html">
                        <i class="pe-7s-users"></i>
                        <p>Impact of human </p>
                    </a>
                </li>
                <li>
                    <a href="saveplanet.html">
                        <i class="pe-7s-look"></i>
                        <p>Save planet Earth</p>
                    </a>
                </li>
                <li>
                    <a href="features.html">
                        <i class="pe-7s-note2"></i>
                        <p>GeneX features</p>
                    </a>
                </li>
            </ul>
        </div>
    </div>

    <div class="main-panel">
        <nav class="navbar navbar-default navbar-fixed" style="background-color: black;">
            <div class="container-fluid">
                <div class="navbar-header" >
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navigation-example-2">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>

                    <a class="navbar-brand" style="color: white;"href="#">Relationship Between Gene Flow and Migration of Peregrine Falcon</a>
					<p><font color="white" size="3">For maximum compatibility use firefox as the browser.</font></p>

                </div>

            </div>
        </nav>

        <div class="content">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12">

					<div class="content">
                            <p id="infobox" class="description text-left" style="color: white;"> 
							Gene flow and the migration patterns of a species is having a high end correlation. As many reserches have approched the gene flow through migration, here we anaylze gene flow probabilities with migration patterns based on sightings. 
							<p>
                        <div class="card">
                            <div class="header">
                                <h4 class="title">Behavior Map</h4>
                            </div>
                            <div class="content">
                                <p id="infobox" class="description text-left">The chart given depicts the information on the number of occurunces of the given species throughout the given timeline. These are the general sightings that has been marked so far for each year that went on.</p>
                                <canvas id="chartCanvas" style="width:100%;"></canvas><br>

                                <p id="infobox" class="description text-left">The map given gives the picture of the species and the migrations and interactions of clusters through the use of heat maps. You can use the slider to visit any temporal value and the map will show the sightings and locations in a heat map. Play, Pause and Reset allows you to automatically play and view the process of the migrations and interactions.
								Note the gene flow probability with the migration density.<p>
                                <div id="slider" ></div>
                                <button onclick="play()">Play</button>
                                <button onclick="pause()">Pause</button>
                                <button onclick="reset()">Reset</button>
                                <input disabled id="year_text" />
                                <div id="map"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <center>
            <footer class="footer">
                <div class="container-fluid">
                    <nav class="pull-left">
                        <ul>
                            <li>
                                <a href="https://2017.spaceappschallenge.org/challenges/our-ecological-neighborhood/where-genes-flow/teams/codon/project">
                                    Team Codon on NASA International SpaceApps 2017
                                </a>
                            </li>

                        </ul>
                    </nav>
                </div>
            </footer>
        </center>
    </div>
</div>

</body>

<!--   Core JS Files   -->
<!--<script src="assets/js/jquery-1.10.2.js" type="text/javascript"></script>-->
<script src="../assets/js/bootstrap.min.js" type="text/javascript"></script>

<!--  Checkbox, Radio & Switch Plugins -->
<script src="../assets/js/bootstrap-checkbox-radio-switch.js"></script>

<!--  Charts Plugin -->
<script src="../assets/js/chartist.min.js"></script>

<!--  Notifications Plugin    -->
<script src="../assets/js/bootstrap-notify.js"></script>

<!-- Light Bootstrap Table Core javascript and methods for Demo purpose -->
<script src="../assets/js/light-bootstrap-dashboard.js"></script>


<script src="../leaflet_heat.js"></script>

<!--<script src="birds.js"></script>-->
<script src="../whale.js"></script>
<script src="../falconOc.js"></script>
<script src="../falcon_geneflow.js"></script>
<script src="../falcon_geneflow_prob.js"></script>
<script src="../chart.js"></script>
<script>

    var map = L.map('map').setView([37.391942, -6.557898], 2);
    var tiles = googleSat = L.tileLayer('http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}',{
        maxZoom: 20,
        subdomains:['mt0','mt1','mt2','mt3']
    }).addTo(map);

    var heatLayer = null
    var drawingPoints = falconOcPoints;
    function setPointsForTime(timeRange){

        map.eachLayer(function (layer) {
            if(layer!=tiles)
                map.removeLayer(layer);
        });

        var heatPoints = drawingPoints
                .filter(function(point){
                    const t = new Date(point[0]);
                    return t>timeRange[0]&&t<timeRange[1];
                })
                .map(function (p) {
                    return [p[1], p[2],10000]; });
        console.log(heatPoints.length);
        heatLayer = L.heatLayer(heatPoints, {
            radius:4,
            blur:10
        }).addTo(map);

        var shape_colors = ['#ff3f69', '#83ff92', '#84b3ff','#ffff59','pink'];
        var shapes = falconGenePoints
                .filter(function(point){
                    const t = new Date(point[0]);
                    return t>timeRange[0]&&t<=timeRange[1];
                })
                .map(function (p) {
                    return [p[1], p[2],p[3],p[4]]; })
                .map(function (p){
                    var clr =  p[3]<shape_colors.length?shape_colors[p[3]]:'orange';
                    L.circle([p[0],p[1]], {
                        radius: p[2]*1000,
                        fillColor:clr,
                        opacity:0.5,
                        color:clr
                    }).addTo(map);
                });

        var markers = falconProbPoints
                .filter(function(point){
                    const t = new Date(point[0]);
                    return t>timeRange[0]&&t<=timeRange[1];
                })
                .map(function (p) {
                    return [p[1], p[2],p[3],p[4]]; })
                .map(function (p){
                    L.marker([p[0],p[1]]).addTo(map);
                    L.marker([p[0],p[1]],
                            {
                                icon: new L.DivIcon({
                                    className: 'marker_label',
                                    html: '<span class="marker_label_span">'+Math.round(p[2]* 100) / 100+'</span>'
                                })}
                    ).addTo(map);
                });

        updateChart(timeRange);
    }

    min_date =  Date.parse('9/6/1999 8:19 PM'); // Date.parse('1929-12-16 09:00:00.000');
    max_date = Date.parse('11/11/17 11:07 PM');
    const gap = 1000*60*60*24*7* 4;//*12*2; //(max_date-min_date)/100//1000*60*60*24*7*4*12;
    const play_gap = gap/2;
    var playing = false;
    var currentValue = min_date;
    $( function() {
        $( "#slider" ).slider({
            max: max_date,
            min: min_date,
            value:min_date,
            change: function( event, ui ) {
                var timeRange = [new Date(ui.value-gap/2), new Date(ui.value+gap/2)]
                setPointsForTime(timeRange);
                currentValue = ui.value;
                d = new Date(currentValue);
                $('#year_text').val(d.getFullYear()+" "+ d.toLocaleString("en-us",{ month: "long" }));
            }
        });
    } );

    function play(){
        playing = true;
    }

    function pause(){
        playing = false;
    }

    function reset(){
        currentValue = min_date;
        playing = false;
        $( "#slider" ).slider("value", currentValue );
    }

    function playMethod(){
        console.log(new Date(currentValue));
        console.log(playing);
        if(playing && currentValue<=max_date)
        {
            currentValue+= play_gap;
            $( "#slider" ).slider("value", currentValue );
            updateChart([currentValue-gap/2,currentValue+gap/2]);
        }
        if(playing && currentValue>max_date)
        {
            pause();
        }
        setTimeout(playMethod, 50);

    }
    playMethod();
    setTimeout(function(){
        $( "#slider" ).slider("value", min_date+gap );
    }, 3000);
    initChart(min_date, max_date, drawingPoints);

</script>
</html>
